model: mart_orders_enriched

defaults:
  inputs:
    users_enriched:             
      rows:
        - {id: 1, email: "x@gmail.com", is_gmail: true}
    orders:
      rows:
        - {order_id: 10, user_id: 1, amount: 19.9}
        - {order_id: 11, user_id: 1, amount: -1.0}
  expect:
    any_order: true
    ignore_columns: []            # e.g. technical columns
    approx:
      amount: 1e-9

cases:
  - name: join_and_flag
    expect:
      rows:
        - {order_id: 10, user_id: 1, email: "x@gmail.com", is_gmail: true, amount: 19.9, valid_amt: true}
        - {order_id: 11, user_id: 1, email: "x@gmail.com", is_gmail: true, amount: -1.0, valid_amt: false}

  - name: override_amount
    inputs:
      orders:
        rows:
          - {order_id: 12, user_id: 1, amount: 0.001}
    expect:
      rows:
        - {order_id: 12, user_id: 1, email: "x@gmail.com", is_gmail: true, amount: 0.001, valid_amt: true}
